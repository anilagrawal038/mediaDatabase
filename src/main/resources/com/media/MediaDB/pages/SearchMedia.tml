<html t:type="mediaLayout" title="MediaDB" xmlns:t="http://tapestry.apache.org/schema/tapestry_5_3.xsd" xmlns:p="tapestry:parameter">

<script type="text/javascript">
	var domObj, dojoObj, domFormObj, queryObj, requestObj, xhrObj;
	setTimeout(
			function() {

				var dojoConfig = {
					async : true
				};

				require.config({
					packages : [ {
						name : 'dojo',
						location : '../js/dojo'
					//,main : "dojo"
					} ],

				});

				require(
						[ 'dojo', 'dojo/dom', "dojo/dom-form", 'dojo/query',
								'dojo/request', "dojo/request/xhr",
								'dojo/domReady!' ],
						function(dojo, dom, domForm, query, request, xhr) {
							dojoObj = dojo;
							domObj = dom;
							domFormObj = domForm;
							queryObj = query;
							requestObj = request;
							xhrObj = xhr;
							console.log(dojo);
							dom.byId("abc").innerHTML = "rerterterterertetrrrrrrrrrrrrrrrrrrrrrre";
						});
			}, 1000);

	//dojo.require("dojo/dojo");
</script>

<div>
	<h3>Search Media File</h3>
</div>
<div class="row" style="margin-left: 2cm; width: 700px">
	<div class="span4 offset3">
		<form id="searchMediaFilterForm" method="post" action="#">
			<h2>Apply filter</h2>
			<br /> <br />
			<div>
				<label style="width: 24%">Media name : </label>
				<input type="text" style="width: 24%" id="name" name="name" value="" />
				<label style="width: 24%; margin-left: 4%">Media maximum size : </label>
				<input type="text" style="width: 24%" id="maximumSize" name="maxSize" value="" />
			</div>
			<div>
				<label style="width: 24%">Media minimum size : </label>
				<input type="text" style="width: 24%" id="minimumSize" name="minSize" value="" />
				<label style="width: 24%; margin-left: 4%">Media created after : </label>
				<input type="text" style="width: 24%" id="createdAfter" name="createdAfterDate" value="" />
			</div>
			<div>
				<label style="width: 24%">Media created before : </label>
				<input type="text" style="width: 24%" id="createdBefore" name="createdBeforeDate" value="" />
				<label style="width: 24%; margin-left: 4%">Media formats : </label>
				<input type="text" style="width: 24%" id="mediaFormats" name="mediaFormats" value="" />
			</div>

			<input type="button" onclick="searchMedia()" style="margin-top: 20px; margin-left: 40%; width: 20%" value="Search" />
		</form>
		<br /> <br />
		<table border="2" width="100%">
			<tr>
				<th>Name</th>
				<th>Location</th>
				<th>Size</th>
				<th>Duration</th>
				<th>Format</th>
				<th>Codecs</th>
				<th>Framerate</th>
				<th>Resolution</th>
				<th>Bitrate</th>
				<th>Date Created</th>
				<th />
				<th />
			</tr>
			<tr>
				<td>1</td>
				<td>2</td>
				<td>3</td>
				<td>1</td>
				<td>2</td>
				<td>3</td>
				<td>1</td>
				<td>2</td>
				<td>3</td>
				<td>1</td>
				<td>2</td>
				<td>3</td>
			</tr>
		</table>
	</div>
</div>
<script>
	var formId = "searchMediaFilterForm";
	var media;

	function updateMedia() {
		var formJson = dojoObj.formToJson(formId);
		console.log("Form submitted with data : " + JSON.stringify(formJson));
		media.name = "updatedWowFile";
		requestObj.put("rest/mediaInfo/8", {
			data : JSON.stringify(media),
			headers : {
				"Content-Type" : "application/json"
			},
			handleAs : "json",
		}).then(
				function(text) {
					console.log("The file's content of updateMedia() is: "
							+ JSON.stringify(text));
				});
	}

	function getMedia() {
		var formJson = dojoObj.formToJson(formId);
		console.log("Form submitted with data : " + JSON.stringify(formJson));
		requestObj.get("rest/mediaInfo/8", {
			data : JSON.stringify(formJson),
			headers : {
				"Content-Type" : "application/json"
			},
			handleAs : "json",
		}).then(
				function(text) {
					media = text;
					console.log("The file's content of getMedia() is: "
							+ JSON.stringify(text));
				});
	}

	function searchMedia() {

		var formJson = dojoObj.formToJson(formId);

		console.log("Form submitted with data : " + JSON.stringify(formJson));

		xhrObj("rest/mediaInfo", {
			handleAs : "json",
			method : 'OPTIONS',
			data : formJson,
			headers : {
				'Content-Type' : 'application/json'
			}
		}).then(
				function(data) {
					console.log("The file's content of searchMediaNew() is: "
							+ JSON.stringify(data));
				},
				function(err) {
					console.log("The file's err of searchMediaNew() is: "
							+ JSON.stringify(err));
				},
				function(evt) {
					console.log("The file's evt of searchMediaNew() is: "
							+ JSON.stringify(evt));
				});

	}
</script>
<div id="abc"></div>
</html>